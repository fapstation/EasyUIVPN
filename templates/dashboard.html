{% extends "base.html" %}

{% block title %}Dashboard - EasyOVPN Management{% endblock %}

{% block content %}
<div class="fade-in">
    <div class="page-header">
        <h1 class="page-title">Dashboard</h1>
        <p class="page-subtitle">OpenVPN server overview and statistics</p>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ stats.total_clients }}</div>
            <div class="stat-label">Total Clients</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value">{{ stats.connected_clients }}</div>
            <div class="stat-label">Connected Now</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value">{{ "%.1f"|format(stats.total_bandwidth_sent / 1024 / 1024) }} MB</div>
            <div class="stat-label">Total Sent</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value">{{ "%.1f"|format(stats.total_bandwidth_received / 1024 / 1024) }} MB</div>
            <div class="stat-label">Total Received</div>
        </div>
    </div>

    <!-- Server Information -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Server Information</h2>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
            <div>
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                    {% if stats.installation_type == 'angristan' %}
                        <i class="fas fa-rocket" style="color: #10b981;"></i>
                        <span style="color: #f1f5f9;">Angristan OpenVPN Installation</span>
                    {% elif stats.installation_type == 'easyrsa' %}
                        <i class="fas fa-key" style="color: #3b82f6;"></i>
                        <span style="color: #f1f5f9;">Standard OpenVPN with EasyRSA</span>
                    {% elif stats.installation_type == 'manual' %}
                        <i class="fas fa-tools" style="color: #f59e0b;"></i>
                        <span style="color: #f1f5f9;">Manual OpenVPN Installation</span>
                    {% else %}
                        <i class="fas fa-question-circle" style="color: #64748b;"></i>
                        <span style="color: #94a3b8;">Unknown Installation Type</span>
                    {% endif %}
                </div>
                {% if stats.installation_type == 'manual' %}
                    <div style="font-size: 0.875rem; color: #fbbf24;">
                        <i class="fas fa-exclamation-triangle"></i>
                        Client creation may require manual setup
                    </div>
                {% elif stats.installation_type == 'unknown' %}
                    <div style="font-size: 0.875rem; color: #f87171;">
                        <i class="fas fa-exclamation-triangle"></i>
                        Unable to detect installation type
                    </div>
                {% endif %}
            </div>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <a href="{{ url_for('create_client') }}" class="btn">
                    <i class="fas fa-plus"></i>
                    New Client
                </a>
                <a href="{{ url_for('clients') }}" class="btn btn-secondary">
                    <i class="fas fa-users"></i>
                    Manage Clients
                </a>
                <a href="{{ url_for('settings') }}" class="btn btn-secondary">
                    <i class="fas fa-cog"></i>
                    Server Settings
                </a>
            </div>
        </div>
    </div>

    <!-- Connected Clients -->
    {% if connected %}
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Currently Connected Clients</h2>
            <span class="status-indicator status-online">
                <span class="status-dot"></span>
                {{ connected|length }} Online
            </span>
        </div>
        
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Client Name</th>
                        <th>Real Address</th>
                        <th>Virtual IP</th>
                        <th>Connected Since</th>
                        <th>Data Transfer</th>
                    </tr>
                </thead>
                <tbody>
                    {% for client in connected %}
                    <tr>
                        <td>
                            <strong>{{ client.name }}</strong>
                        </td>
                        <td>{{ client.real_address }}</td>
                        <td><code>{{ client.virtual_address }}</code></td>
                        <td>{{ client.connected_since }}</td>
                        <td>
                            <div style="font-size: 0.875rem;">
                                <div><i class="fas fa-upload" style="color: #10b981;"></i> {{ "%.2f"|format(client.bytes_sent / 1024 / 1024) }} MB</div>
                                <div><i class="fas fa-download" style="color: #3b82f6;"></i> {{ "%.2f"|format(client.bytes_received / 1024 / 1024) }} MB</div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- All Clients Overview -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">All Clients</h2>
            <span style="color: #94a3b8;">{{ clients|length }} total</span>
        </div>
        
        {% if clients %}
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Client Name</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for client in clients %}
                    <tr>
                        <td><strong>{{ client.name }}</strong></td>
                        <td>
                            <span class="client-status status-indicator {{ 'status-online' if client.connected else 'status-offline' }}" data-client="{{ client.name }}">
                                <span class="status-dot"></span>
                                {{ 'Online' if client.connected else 'Offline' }}
                            </span>
                        </td>
                        <td>{{ client.created }}</td>
                        <td>
                            <div style="display: flex; gap: 0.5rem;">
                                <a href="{{ url_for('download_client', client_name=client.name) }}" class="btn btn-sm btn-secondary" title="Download Config">
                                    <i class="fas fa-download"></i>
                                </a>
                                <a href="{{ url_for('client_qrcode', client_name=client.name) }}" class="btn btn-sm btn-secondary" title="QR Code">
                                    <i class="fas fa-qrcode"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 3rem; color: #64748b;">
            <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
            <p style="font-size: 1.1rem; margin-bottom: 1rem;">No clients configured yet</p>
            <a href="{{ url_for('create_client') }}" class="btn">
                <i class="fas fa-plus"></i>
                Create First Client
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %} 