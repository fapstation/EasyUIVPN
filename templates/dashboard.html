{% extends "base.html" %}

{% block title %}Dashboard - EasyUIVPN Management{% endblock %}

{% block content %}
<div class="dashboard-header" style="margin-bottom: 2rem;">
    <h1 style="color: #f1f5f9; margin: 0;">
        <i class="fas fa-tachometer-alt" style="margin-right: 0.5rem; color: #10b981;"></i>
        Dashboard
    </h1>
</div>

<!-- Update Notice -->
{% if stats.update_info.update_available %}
<div class="card" style="margin-bottom: 1.5rem; border-left: 4px solid #f59e0b;">
    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.2); border-radius: 0.5rem; padding: 1rem;">
        <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap;">
            <div>
                <h4 style="color: #f59e0b; margin: 0 0 0.5rem 0;">
                    <i class="fas fa-download"></i> Update Available
                </h4>
                <p style="color: #fbbf24; margin: 0; font-size: 0.875rem;">
                    Version {{ stats.update_info.latest_version }} is available (current: {{ stats.update_info.current_version }})
                </p>
            </div>
            <a href="{{ stats.update_info.download_url }}" target="_blank" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem; background: #f59e0b; border-color: #f59e0b;">
                <i class="fas fa-external-link-alt"></i> View Release
            </a>
        </div>
    </div>
</div>
{% endif %}

<!-- Server Statistics Row -->
<div class="stats-row" style="margin-bottom: 2rem;">
    <div class="stat-card">
        <div class="stat-value">{{ stats.total_clients }}</div>
        <div class="stat-label">Total Clients</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.connected_clients }}</div>
        <div class="stat-label">Connected</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ "%.1f"|format(stats.total_bandwidth_sent / 1024 / 1024) }} MB</div>
        <div class="stat-label">Total Sent</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ "%.1f"|format(stats.total_bandwidth_received / 1024 / 1024) }} MB</div>
        <div class="stat-label">Total Received</div>
    </div>
</div>

<!-- Server Information -->
<div class="card" style="margin-bottom: 1.5rem;">
    <div class="card-header">
        <h2 class="card-title">
            <i class="fas fa-server" style="color: #3b82f6;"></i>
            Server Information
        </h2>
    </div>
    <div class="card-content">
        <div class="stats-row">
            <div class="stat-item">
                <div class="stat-value" style="font-size: 1rem; font-family: monospace;">{{ stats.server_ips.internal }}</div>
                <div class="stat-label">Internal IP</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" style="font-size: 1rem; font-family: monospace;">{{ stats.server_ips.external }}</div>
                <div class="stat-label">External IP</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">v{{ stats.version }}</div>
                <div class="stat-label">Version</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" style="font-size: 0.875rem;">
                    {% if stats.can_manage_clients %}
                        <span style="color: #10b981;">Full</span>
                    {% else %}
                        <span style="color: #f59e0b;">Monitor</span>
                    {% endif %}
                </div>
                <div class="stat-label">Mode</div>
            </div>
        </div>
        <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 0.5rem; text-align: center; font-size: 0.875rem; color: #93c5fd;">
            <i class="fas fa-info-circle" style="margin-right: 0.5rem;"></i>
            <strong>VPN Access:</strong> {{ stats.server_ips.external }}:1194 (External) â€¢ {{ stats.server_ips.internal }}:1194 (Internal)
        </div>
    </div>
</div>

<!-- Connected Clients -->
{% if connected %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">Currently Connected Clients</h2>
        <span class="status-indicator status-online">
            <span class="status-dot"></span>
            {{ connected|length }} Online
        </span>
    </div>
    
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Client Name</th>
                    <th>Real Address</th>
                    <th>Virtual IP</th>
                    <th>Connected Since</th>
                    <th>Data Transfer</th>
                </tr>
            </thead>
            <tbody>
                {% for client in connected %}
                <tr>
                    <td>
                        <strong>{{ client.name }}</strong>
                    </td>
                    <td>{{ client.real_address }}</td>
                    <td><code>{{ client.virtual_address }}</code></td>
                    <td>{{ client.connected_since }}</td>
                    <td>
                        <div style="font-size: 0.875rem;">
                            <div><i class="fas fa-upload" style="color: #10b981;"></i> {{ "%.2f"|format(client.bytes_sent / 1024 / 1024) }} MB</div>
                            <div><i class="fas fa-download" style="color: #3b82f6;"></i> {{ "%.2f"|format(client.bytes_received / 1024 / 1024) }} MB</div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- All Clients Overview -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">All Clients</h2>
        <span style="color: #94a3b8;">{{ clients|length }} total</span>
    </div>
    
    {% if clients %}
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Client Name</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for client in clients %}
                <tr>
                    <td><strong>{{ client.name }}</strong></td>
                    <td>
                        <span class="client-status status-indicator {{ 'status-online' if client.connected else 'status-offline' }}" data-client="{{ client.name }}">
                            <span class="status-dot"></span>
                            {{ 'Online' if client.connected else 'Offline' }}
                        </span>
                    </td>
                    <td>{{ client.created }}</td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="{{ url_for('download_client', client_name=client.name) }}" class="btn btn-sm btn-secondary" title="Download Config">
                                <i class="fas fa-download"></i>
                            </a>
                            <a href="{{ url_for('client_qrcode', client_name=client.name) }}" class="btn btn-sm btn-secondary" title="QR Code">
                                <i class="fas fa-qrcode"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="text-align: center; padding: 3rem; color: #64748b;">
        <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
        <p style="font-size: 1.1rem; margin-bottom: 1rem;">No clients configured yet</p>
        <a href="{{ url_for('create_client') }}" class="btn">
            <i class="fas fa-plus"></i>
            Create First Client
        </a>
    </div>
    {% endif %}
</div>
</div>
{% endblock %} 